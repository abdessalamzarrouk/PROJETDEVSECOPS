<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Détails Opération de Recette</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    /* Original card style, though we're adding more specific styles now */
    .card {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .detail-item {
      padding: 0.75rem 0;
      border-bottom: 1px solid #edf2f7; /* gray-200 */
      display: flex; /* Ensure labels and values align for all details */
      align-items: flex-start; /* Align to top if content wraps */
    }
    .detail-item:last-child {
      border-bottom: none;
    }
    .detail-label {
      font-weight: 600;
      color: #4a5568; /* gray-700 */
      width: 150px; /* Fixed width for labels for alignment */
      flex-shrink: 0;
      margin-right: 1rem; /* Add some space between label and value */
    }
    .detail-value {
      color: #2d3748; /* gray-800 */
      flex-grow: 1;
    }

    /* New styles for Contribuable section */
    .contribuable-card {
      background-color: #f8fafc; /* Tailwind gray-50 */
      border: 1px solid #e2e8f0; /* Tailwind gray-200 */
      border-radius: 0.5rem; /* rounded-lg */
      padding: 1rem;
      margin-top: 0.5rem; /* Space from the label */
    }
    .contribuable-heading {
      font-weight: 700; /* font-bold */
      color: #2563eb; /* indigo-700 or blue-700 */
      margin-bottom: 0.75rem; /* mb-3 */
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #bfdbfe; /* blue-200 */
    }
    .contribuable-detail-row {
      display: flex;
      align-items: baseline; /* Align key and value baseline */
      margin-bottom: 0.5rem; /* Space between rows */
    }
    .contribuable-key {
      font-weight: 500; /* font-medium */
      color: #4a5568; /* gray-700 */
      width: 100px; /* Adjust as needed */
      flex-shrink: 0;
    }
    .contribuable-value {
      color: #1a202c; /* gray-900 */
      flex-grow: 1;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal min-h-screen flex flex-col">

<div class="flex flex-grow">
  <aside class="w-64 bg-gray-900 text-gray-200 flex-shrink-0 h-full sticky top-0 overflow-y-auto">
    <div class="w-full h-25 overflow-hidden flex items-center justify-center">
      <img th:src="@{/images/TGR-LOGO2.svg}" alt="Your Logo" class="w-full h-full object-cover">
    </div>
    <div class="p-6">
      <nav>
        <ul>
          <li class="mb-2">
            <a th:href="@{/comptable/dashboard}" class="block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">Tableau de bord</a>
          </li>
          <li class="mb-2">
            <a th:href="@{/bordereaux}" class="block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">Bordereaux</a>
          </li>
          <li class="mb-2">
            <a th:href="@{/articles-recette}" class="block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">Articles de Recette</a>
          </li>
          <li class="mb-2">
            <a th:href="@{/operations-recette}" class="block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 bg-gray-700 hover:text-white">Opérations de Recette</a>
          </li>
          <li class="mb-2">
            <a th:href="@{/rubriques-budgetaires}" class="block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">Rubriques Budgétaires</a>
          </li>
          <li class="mb-2">
            <a th:href="@{/reports}" class="block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white">Rapports</a>
          </li>
          <li class="my-4 border-t border-gray-700"></li>
          <li class="mb-2">
            <a th:href="@{/profile}" class="block py-2 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-white text-white">Profil</a> </li>
          <li>
            <form th:action="@{/logout}" method="post" class="w-full">
              <button type="submit" class="block w-full text-left py-2 px-4 rounded transition duration-200 hover:bg-red-700 hover:text-white text-red-300">
                Déconnexion
              </button>
            </form>
          </li>
        </ul>
      </nav>
    </div>
  </aside>

  <main class="flex-1 p-4">
    <div class="container mx-auto p-6 bg-white rounded-lg shadow-xl mt-8">
      <div class="flex justify-between items-center mb-6 border-b pb-4">
        <h1 class="text-3xl font-bold text-gray-800">Détails de l'Opération de Recette</h1>
        <div class="flex items-center space-x-4">
          <span class="text-gray-600">Connecté en tant que :  <strong th:text="${connectedUserFullName ?: 'Invité'}" class="text-indigo-600"></strong></span>
          <form th:action="@{/logout}" method="post">
            <button type="submit" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-200">
              Déconnexion
            </button>
          </form>
        </div>
      </div>

      <div th:if="${operationRecette == null}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
        <span class="block sm:inline">Opération de recette non trouvée.</span>
      </div>

      <div th:if="${operationRecette != null}" class="bg-white p-6 rounded-lg shadow">
        <div class="flex items-center detail-item">
          <div class="detail-label">Numéro Recette:</div>
          <div class="detail-value" th:text="${operationRecette.numRecette}"></div>
        </div>
        <div class="flex items-center detail-item">
          <div class="detail-label">Date Recouvrement:</div>
          <div class="detail-value" th:text="${#temporals.format(operationRecette.dateRecouv, 'dd-MM-yyyy')}"></div>
        </div>
        <div class="flex items-center detail-item">
          <div class="detail-label">Date Valeur Opération:</div>
          <div class="detail-value" th:text="${#temporals.format(operationRecette.dateValeurOP, 'dd-MM-yyyy')}"></div>
        </div>
        <div class="flex items-center detail-item">
          <div class="detail-label">Date Opération:</div>
          <div class="detail-value" th:text="${#temporals.format(operationRecette.dateOperation, 'dd-MM-yyyy')}"></div>
        </div>
        <div class="flex items-center detail-item">
          <div class="detail-label">Montant Recette:</div>
          <div class="detail-value" th:text="${#numbers.formatCurrency(operationRecette.montantRecette)}"></div>
        </div>
        <div class="flex items-center detail-item">
          <div class="detail-label">Provenance:</div>
          <div class="detail-value" th:text="${operationRecette.provenance}"></div>
        </div>
        <div class="flex items-center detail-item">
          <div class="detail-label">État Recette:</div>
          <div class="detail-value" th:text="${operationRecette.etatRecette}"></div>
        </div>
        <div class="flex items-center detail-item">
          <div class="detail-label">Montant Majoration:</div>
          <div class="detail-value" th:text="${#numbers.formatCurrency(operationRecette.montantMajoration)}"></div>
        </div>
        <div class="flex items-center detail-item">
          <div class="detail-label">Mode de Paiement:</div>
          <div class="detail-value" th:text="${operationRecette.modePaiement}"></div>
        </div>
        <div class="flex items-center detail-item">
          <div class="detail-label">Observation:</div>
          <div class="detail-value" th:text="${operationRecette.observation ?: 'N/A'}"></div>
        </div>

        <div class="flex items-center detail-item">
          <div class="detail-label">Article de Recette:</div>
          <div class="detail-value">
            <span th:if="${operationRecette.articleRecette != null}"
                  th:text="${operationRecette.articleRecette.typeAR + ' (ID: ' + operationRecette.articleRecette.numArticleRecette + ', Montant: ' + operationRecette.articleRecette.montantAR + ')'}"></span>
            <span th:unless="${operationRecette.articleRecette != null}">N/A</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-label">Contribuable:</div>
          <div class="detail-value">
            <div th:if="${operationRecette.contribuable != null}" class="contribuable-card">
              <span th:if="${operationRecette.contribuable instanceof T(com.main.projetstage.models.PersonneContribuable)}">
                <h4 class="contribuable-heading">Détails Personne Physique</h4>
                <div class="contribuable-detail-row">
                  <div class="contribuable-key">Nom:</div>
                  <div class="contribuable-value" th:text="${operationRecette.contribuable.nomContribuable}"></div>
                </div>
                <div class="contribuable-detail-row">
                  <div class="contribuable-key">Prénom:</div>
                  <div class="contribuable-value" th:text="${operationRecette.contribuable.prenomContribuable}"></div>
                </div>
                <div class="contribuable-detail-row">
                  <div class="contribuable-key">CIN:</div>
                  <div class="contribuable-value" th:text="${operationRecette.contribuable.cinContribuable}"></div>
                </div>
                <div class="contribuable-detail-row">
                  <div class="contribuable-key">Adresse:</div>
                  <div class="contribuable-value" th:text="${operationRecette.contribuable.adresseAuxiliaire}"></div>
                </div>
              </span>
              <span th:if="${operationRecette.contribuable instanceof T(com.main.projetstage.models.SocieteContribuable)}">
                <h4 class="contribuable-heading">Détails Personne Morale (Société)</h4>
                <div class="contribuable-detail-row">
                  <div class="contribuable-key">Raison Sociale:</div>
                  <div class="contribuable-value" th:text="${operationRecette.contribuable.raisonSociale}"></div>
                </div>
                <div class="contribuable-detail-row">
                  <div class="contribuable-key">ID Fiscal:</div>
                  <div class="contribuable-value" th:text="${operationRecette.contribuable.idFiscal}"></div>
                </div>
                <div class="contribuable-detail-row">
                  <div class="contribuable-key">Adresse Fiscale:</div>
                  <div class="contribuable-value" th:text="${operationRecette.contribuable.adresseFiscale}"></div>
                </div>
                <div class="contribuable-detail-row">
                  <div class="contribuable-key">Type Organisme:</div>
                  <div class="contribuable-value" th:text="${operationRecette.contribuable.typeOrganisme}"></div>
                </div>
              </span>
            </div>
            <span th:unless="${operationRecette.contribuable != null}">N/A</span>
          </div>
        </div>
        <div class="flex justify-start space-x-4 mt-6">
          <a th:href="@{/operations-recette/{numRecette}/edit(numRecette=${operationRecette.numRecette})}" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
            Modifier
          </a>
          <a th:href="@{/operations-recette}" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
            Retour à la liste
          </a>
        </div>
      </div>
    </div>
  </main>
</div>

</body>
</html>